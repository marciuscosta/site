{"id":12,"date":"2022-03-11T01:21:16","date_gmt":"2022-03-11T01:21:16","guid":{"rendered":"http:\/\/localhost\/?p=12"},"modified":"2022-03-11T01:30:08","modified_gmt":"2022-03-11T01:30:08","slug":"redimensionando-disco-virtual-no-debian-com-particao-lvm-sem-perda-de-dados","status":"publish","type":"post","link":"http:\/\/10.0.0.181\/index.php\/2022\/03\/11\/redimensionando-disco-virtual-no-debian-com-particao-lvm-sem-perda-de-dados\/","title":{"rendered":"Redimensionando disco virtual no Debian com parti\u00e7\u00e3o LVM sem perda de dados"},"content":{"rendered":"\n<p><\/p>\n\n\n\n<p>O cen\u00e1rio \u00e9 o seguinte:<\/p>\n\n\n\n<ul><li>Servidor Debian Buster com Kernel 4.19.194-2 virtualizado em VirtualBox<\/li><li>Disco virtual de 50GB precisa ser aumentado para 100GB<\/li><li>Parti\u00e7\u00e3o \u00fanica em LVM no segundo disco (\/dev\/sdb)<\/li><\/ul>\n\n\n\n<p><\/p>\n\n\n\n<h1>..::|&nbsp;<strong>Redimensionando<\/strong><\/h1>\n\n\n\n<p>Ap\u00f3s aumentar o disco virtual no VirtualBox com o servidor Debian desligado, inicie-o e verifique se o novo tamanho foi reconhecido:<\/p>\n\n\n\n<figure class=\"wp-block-image size-full\"><img loading=\"lazy\" width=\"502\" height=\"179\" src=\"http:\/\/localhost\/wp-content\/uploads\/2022\/03\/1-fdisk-sdb.png\" alt=\"\" class=\"wp-image-16\"\/><\/figure>\n\n\n\n<p>Caso o disco esteja montado, lembre-se de desmonta-lo:<\/p>\n\n\n\n<pre class=\"wp-block-code\"><code>test@debian:~$ sudo umount \/dev\/sdb1<\/code><\/pre>\n\n\n\n<p>Verifique as informa\u00e7\u00f5es do volume l\u00f3gico para pegar o nome dele. Execute \u201c<em>sudo lvscan<\/em>\u201c:<\/p>\n\n\n\n<figure class=\"wp-block-image size-full\"><img loading=\"lazy\" width=\"470\" height=\"35\" src=\"http:\/\/localhost\/wp-content\/uploads\/2022\/03\/1-lvscan-edit-1.png\" alt=\"\" class=\"wp-image-17\"\/><\/figure>\n\n\n\n<p>Desative o volume l\u00f3gico:<\/p>\n\n\n\n<pre class=\"wp-block-code\"><code>test@debian:~$ sudo lvchange -a n \/dev\/test\/lvol0<\/code><\/pre>\n\n\n\n<p>Caso j\u00e1 n\u00e3o o tenha, instale o \u201c<em>parted<\/em>\u201d para redimensionar a parti\u00e7\u00e3o LVM:<\/p>\n\n\n\n<pre class=\"wp-block-code\"><code>test@debian:~$ sudo apt-get install parted<\/code><\/pre>\n\n\n\n<p>Inicialize o&nbsp;<em>parted<\/em>&nbsp;no disco a ser redimensionado:<\/p>\n\n\n\n<pre class=\"wp-block-code\"><code>test@debian:~$ sudo parted \/dev\/sdb<\/code><\/pre>\n\n\n\n<p>No ambiente do\u00a0<em>parted<\/em>, verifique a capacidade total do disco com o comando \u201c<em>print<\/em>\u201d afim de saber para qual tamanho pode-se aumentar a parti\u00e7\u00e3o \/dev\/sdb1 com o comando \u201c<em>resizepart<\/em>\u201c:<\/p>\n\n\n\n<figure class=\"wp-block-image size-full\"><img loading=\"lazy\" width=\"543\" height=\"497\" src=\"http:\/\/localhost\/wp-content\/uploads\/2022\/03\/1-parted-edit-1.png\" alt=\"\" class=\"wp-image-18\"\/><\/figure>\n\n\n\n<p>Insira as informa\u00e7\u00f5es mostradas pelo comando \u201c<em>print<\/em>\u201d nas duas perguntas que o comando \u201c<em>resizepart<\/em>\u201d faz, conforme os destaques em vermelho na imagem acima.<\/p>\n\n\n\n<p>Agora aumente o physical volume dessa parti\u00e7\u00e3o com o comando \u201c<em>sudo pvresize \/dev\/sdb1<\/em>\u201c.<\/p>\n\n\n\n<figure class=\"wp-block-image size-full\"><img loading=\"lazy\" width=\"612\" height=\"50\" src=\"http:\/\/localhost\/wp-content\/uploads\/2022\/03\/1-pvresize-sdb1png.png\" alt=\"\" class=\"wp-image-20\"\/><figcaption><em>Com o comando \u201csudo pvs\u201d voc\u00ea pode confirmar se o tamanho do physical volume foi aumentado com sucesso.<\/em><\/figcaption><\/figure>\n\n\n\n<p>Redimensione o volume l\u00f3gico para o m\u00e1ximo dispon\u00edvel:<\/p>\n\n\n\n<pre class=\"wp-block-code\"><code>test@debian:~$ sudo lvextend -l +100%FREE \/dev\/test\/lvol0<\/code><\/pre>\n\n\n\n<figure class=\"wp-block-image size-full\"><img loading=\"lazy\" width=\"801\" height=\"65\" src=\"http:\/\/localhost\/wp-content\/uploads\/2022\/03\/1-lvextend-edit.png\" alt=\"\" class=\"wp-image-21\"\/><\/figure>\n\n\n\n<p>Ative novamente o volume l\u00f3gico com o comando:<\/p>\n\n\n\n<pre class=\"wp-block-code\"><code>test@debian:~$ sudo lvchange -a y \/dev\/test\/lvol0<\/code><\/pre>\n\n\n\n<p>Fa\u00e7a uma checagem da parti\u00e7\u00e3o antes de redimension\u00e1-la (\u00e9 necess\u00e1rio):<\/p>\n\n\n\n<figure class=\"wp-block-image size-full\"><img loading=\"lazy\" width=\"637\" height=\"130\" src=\"http:\/\/localhost\/wp-content\/uploads\/2022\/03\/1-e2fsck.png\" alt=\"\" class=\"wp-image-22\"\/><\/figure>\n\n\n\n<p>Execute o\u00a0<em>resize2fs<\/em>\u00a0nessa parti\u00e7\u00e3o para que o novo tamanho seja reconhecido:<\/p>\n\n\n\n<figure class=\"wp-block-image size-full\"><img loading=\"lazy\" width=\"549\" height=\"72\" src=\"http:\/\/localhost\/wp-content\/uploads\/2022\/03\/1-resize2fs.png\" alt=\"\" class=\"wp-image-23\"\/><\/figure>\n\n\n\n<p>Pronto!<\/p>\n\n\n\n<p>Agora basta montar a parti\u00e7\u00e3o com o comando&nbsp;<em>mount<\/em>.<\/p>\n\n\n\n<pre class=\"wp-block-code\"><code>test@debian:~$ sudo mount \/dev\/test\/lvol0 \/destino_da_montagem<\/code><\/pre>\n\n\n\n<figure class=\"wp-block-image size-full\"><img loading=\"lazy\" width=\"496\" height=\"177\" src=\"http:\/\/localhost\/wp-content\/uploads\/2022\/03\/1-mount.png\" alt=\"\" class=\"wp-image-24\"\/><\/figure>\n\n\n\n<p>Caso o redimensionamento seja em um disco onde esteja rodando a raiz do sistema, basta usar um live-cd e seguir esses mesmos passos.<\/p>\n\n\n\n<blockquote class=\"wp-block-quote\"><p><strong>Fontes:<\/strong><br><a href=\"https:\/\/www.tecmint.com\/parted-command-to-create-resize-rescue-linux-disk-partitions\/\">https:\/\/www.tecmint.com\/parted-command-to-create-resize-rescue-linux-disk-partitions\/<\/a><br><a href=\"https:\/\/wiki.debian.org\/LVM\" target=\"_blank\" rel=\"noreferrer noopener\">https:\/\/wiki.debian.org\/LVM<\/a><\/p><\/blockquote>\n\n\n\n<p><\/p>\n","protected":false},"excerpt":{"rendered":"<p>Nesse artigo, explico como aumentar uma parti\u00e7\u00e3o LVM de um disco virtual redimensionado sem ter que refazer a parti\u00e7\u00e3o, ou seja, sem perda de dados.<\/p>\n","protected":false},"author":1,"featured_media":14,"comment_status":"closed","ping_status":"closed","sticky":false,"template":"","format":"standard","meta":[],"categories":[3],"tags":[],"_links":{"self":[{"href":"http:\/\/10.0.0.181\/index.php\/wp-json\/wp\/v2\/posts\/12"}],"collection":[{"href":"http:\/\/10.0.0.181\/index.php\/wp-json\/wp\/v2\/posts"}],"about":[{"href":"http:\/\/10.0.0.181\/index.php\/wp-json\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"http:\/\/10.0.0.181\/index.php\/wp-json\/wp\/v2\/users\/1"}],"replies":[{"embeddable":true,"href":"http:\/\/10.0.0.181\/index.php\/wp-json\/wp\/v2\/comments?post=12"}],"version-history":[{"count":4,"href":"http:\/\/10.0.0.181\/index.php\/wp-json\/wp\/v2\/posts\/12\/revisions"}],"predecessor-version":[{"id":28,"href":"http:\/\/10.0.0.181\/index.php\/wp-json\/wp\/v2\/posts\/12\/revisions\/28"}],"wp:featuredmedia":[{"embeddable":true,"href":"http:\/\/10.0.0.181\/index.php\/wp-json\/wp\/v2\/media\/14"}],"wp:attachment":[{"href":"http:\/\/10.0.0.181\/index.php\/wp-json\/wp\/v2\/media?parent=12"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"http:\/\/10.0.0.181\/index.php\/wp-json\/wp\/v2\/categories?post=12"},{"taxonomy":"post_tag","embeddable":true,"href":"http:\/\/10.0.0.181\/index.php\/wp-json\/wp\/v2\/tags?post=12"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}